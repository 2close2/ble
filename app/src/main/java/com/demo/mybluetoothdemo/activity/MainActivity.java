package com.demo.mybluetoothdemo.activity;

import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.bluetooth.BluetoothGattCharacteristic;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.pm.PackageManager;
import android.location.LocationManager;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.provider.Settings;
import android.support.annotation.NonNull;
import android.support.v4.app.ActivityCompat;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.AppCompatActivity;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.Switch;
import android.widget.TextView;
import android.widget.Toast;

import com.demo.mybluetoothdemo.R;
import com.demo.mybluetoothdemo.callback.BleConnectionCallBack;
import com.demo.mybluetoothdemo.entity.EventMsg;
import com.demo.mybluetoothdemo.utils.CheckUtils;
import com.demo.mybluetoothdemo.utils.Constants;
import com.demo.mybluetoothdemo.utils.bleutils.BleConnectUtil;
import com.kaopiz.kprogresshud.KProgressHUD;
import com.king.zxing.CaptureActivity;

import org.greenrobot.eventbus.EventBus;
import org.greenrobot.eventbus.Subscribe;
import org.greenrobot.eventbus.ThreadMode;

import java.util.ArrayList;
import java.util.List;

import butterknife.BindView;
import butterknife.ButterKnife;
import butterknife.OnClick;

import static com.demo.mybluetoothdemo.utils.bleutils.BleConnectUtil.mBluetoothGattCharacteristic;
import static com.king.zxing.CaptureFragment.KEY_RESULT;


/**
 * 思路/步骤：
 * 1、权限问题：先判断手机是否满足android4.3以上版本，再判断手机是否开启蓝牙。
 * 2、搜索蓝牙：搜索蓝牙，回调接口中查看ble设备相关信息，一定时间停止扫描。
 * 3、连接蓝牙：首先获取到ble设备的mac地址，然后调用connect()方法进行连接。
 * 4、获取特征：蓝牙连接成功后，需要获取蓝牙的服务特征等，然后开启接收设置。
 * 5、发送消息：writeCharacteristic()方法，发送数据给ble设备。
 * 6、接收消息：通过蓝牙的回调接口中onCharacteristicRead()方法，接收蓝牙收的消息。
 * 7、释放资源：断开连接，关闭资源。
 * <p>
 * PS:请修改 BleConnectUtil.java文件中serviceUuidStr、writeCharactUuid以及notifyCharactUuid这三个变量值，确保与您设备的uuid相同才可通讯。
 *
 * @author mokojo
 * @version 1.0.4
 * @date 2020/6/3
 */
public class MainActivity extends AppCompatActivity {
    @BindView(R.id.btn_scanQR)
    Button btnScanQR;
    @BindView(R.id.tv_ble_name)
    TextView tvBleName;
    @BindView(R.id.btn_send)
    Button btnSend;
    @BindView(R.id.btn_disconnect)
    Button btnDisconnect;
    @BindView(R.id.ed_write_order)
    EditText edWriteOrder;
    @BindView(R.id.tv_receiver)
    TextView tvReceiver;
    @BindView(R.id.ll_status_bluetooth)
    LinearLayout llBlueStatus;
    @BindView(R.id.ll_status_locatioin)
    LinearLayout llLocationStatus;
    @BindView(R.id.sw)
    Switch sw;
    @BindView(R.id.bt_input_address)
    Button btnAddress;

    private ArrayAdapter<String> adapter;

    private static int index;
    private List<String> cmd;

    private int selectPos;
    private KProgressHUD dialog;
    int regainBleDataCount = 0;
    String currentRevice, currentSendOrder;
    byte[] sData = null;

    // 广播
    private BLeBroadcastReceiver mBroadcastReceiver = new BLeBroadcastReceiver();
    private LocationBroadcastReceiver mLocationBroadcastReceiver = new LocationBroadcastReceiver();

    //requestCode
    private final int requestCodeBluetooth = 1, requestCodeCamera = 2, requestCodeQR = 3;

    //表地址
    private String meterAddress;

    /**
     * 跟ble通信的标志位,检测数据是否在指定时间内返回
     */
    private boolean bleFlag = false;
    BleConnectUtil bleConnectUtil;

    Handler handler = new Handler() {
        @Override
        public void handleMessage(Message msg) {
            super.handleMessage(msg);
            Log.d("数据帧", "Main-->" + msg.what);
            switch (msg.what) {
                case 10:
                    //接收到数据，显示在界面上
                    dialog.dismiss();
                    tvReceiver.append(msg.obj.toString() + "\n");
                    Log.i("1111", index + "\t" + msg.obj.toString());
                    Log.d("数据帧", "Main-->" + "接受");
                    if (index < (cmd.size() - 1)) {
                        index++;
                        try {
                            Thread.sleep(500);
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                        sendData();
                        handler.postDelayed(checkConnetRunnable, 5000);
                    }
                    break;
                case 1000:
                    regainBleDataCount = 0;
                    bleFlag = false;
                    handler.removeCallbacks(checkConnetRunnable);

                    if (dialog != null) {
                        dialog.dismiss();
                    }
                    Log.d("数据帧", "Main-->" + "超时");
                    Toast.makeText(MainActivity.this, "超时请重试!", Toast.LENGTH_SHORT).show();
                    break;
                case 1111:
                    handler.removeCallbacks(checkConnetRunnable);
                    tvBleName.setVisibility(View.GONE);
                    tvReceiver.setText("");
                    edWriteOrder.setText("");
                    bleConnectUtil.disConnect();
                    break;
                default:
                    break;
            }
        }
    };


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        ButterKnife.bind(this);
        EventBus.getDefault().register(this);
        initView();

        checkDeviceSupport();
        checkBluetoothStatus();
        checkLocationStats();

        sw.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
            @Override
            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
                if (isChecked) {
                    Log.d("开关", "Main-->" + "is");
                    btnScanQR.setVisibility(View.GONE);
                    ((LinearLayout) (findViewById(R.id.inputAddress))).setVisibility(View.VISIBLE);
                } else {
                    Log.d("开关", "Main-->" + "不is");
                    btnScanQR.setVisibility(View.VISIBLE);
                    ((LinearLayout) (findViewById(R.id.inputAddress))).setVisibility(View.GONE);
                }
            }
        });
    }


    private void initView() {
        bleConnectUtil = new BleConnectUtil(MainActivity.this);

        mLocationBroadcastReceiver.setStatus(true);
        registerReceiver(mLocationBroadcastReceiver, new IntentFilter("android.location.PROVIDERS_CHANGED"));
        mBroadcastReceiver.setStatus(true);
        registerReceiver(mBroadcastReceiver, new IntentFilter(BluetoothAdapter.ACTION_STATE_CHANGED));

        dialog = CheckUtils.showDialog(MainActivity.this);
    }


    @OnClick({R.id.btn_send, R.id.btn_disconnect, R.id.tx_open_ble, R.id.tx_open_location, R.id.btn_scanQR, R.id.bt_conn, R.id.bt_input_address})
    public void onViewClicked(View view) {
        switch (view.getId()) {
            case R.id.tx_open_ble://打开蓝牙
                Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
                startActivityForResult(enableBtIntent, 1);
                break;
            case R.id.tx_open_location://打开定位
                Intent settingsIntent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);
                settingsIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                this.startActivity(settingsIntent);
                break;
            case R.id.btn_scanQR://扫描二维码
                if (ContextCompat.checkSelfPermission(MainActivity.this,
                        android.Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {
                    ActivityCompat.requestPermissions(MainActivity.this, new String[]{android.Manifest.permission.CAMERA}, requestCodeCamera);
                    return;
                }
                Intent intent = new Intent(this, CaptureActivity.class);
                startActivityForResult(intent, requestCodeQR);
                break;
            case R.id.bt_input_address://手动输入表地址获取MAC地址
                String rowAddress = ((TextView) findViewById(R.id.tx_input_address)).getText().toString().trim();
                if (rowAddress.length() == 0) return;
                long aaa = Long.parseLong(rowAddress);
                //表地址倒叙
                meterAddress = CheckUtils.getMeterAddress(String.format("%012d", aaa));
                CheckUtils.setAddrss(meterAddress);
                //对应的MAC地址
                String macAddress = CheckUtils.getMacAddress(("C0:" + String.format("%010x", aaa)).toUpperCase());
                tvBleName.setText(macAddress);
                break;
            case R.id.bt_conn://连接电表
                bleConnectUtil.stopScan();
                dialog.show();
                String a = tvBleName.getText().toString();
                bleConnectUtil.connectBle(a);
                break;
            case R.id.btn_send://发送数据按钮
                if (bleConnectUtil.isConnected()) {
                    cmd = new ArrayList<String>();
                    cmd.add("04C83F43F3D544563953633963BC81333333DF06A66A33336F333533EF3633100EBF6233EF3633145BF834C033353333E3F8526E3435343433D33333338436B335B335B351B33DB335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B335B36D7DB356A97F7F6F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F7F593F583335343365A1E6D83435343433D3333333");
                    cmd.add("04C83F43F3D544563953633963BC813334334F243E5B8AF45AACF45A58B35B357F347F347FA6594F333535337C4EF0D93435343433D333333338579AF46E487F346CE15233353633878C8A3F3435343433D33333333B613AB35FADB357AD7F7F41FE5133353733D97F1EB83435343433D33333333A71AAB335B354357F7FDB2C6E33353833922B9A043435343433D33333334B58A2F438F4573CF438F45F98F4538CB358A5B3538DF454907F347F347F347F347F347F7F7F34F7CD6133353933A252491B3435343433D3");
                    cmd.add("04C83F43F3D544563953633963BC813335335A7A333333433AF457A4F4578CB35D9DF45570F45BAC7F347F347F7F347F3476385933353A33046C80213435343433D33333333F6762B335F434B35B49B356617F7F347F7F8499A733353B33EC5B0C123435343433D33333337453B2B3543FB335B335F434B335B335B335F434B347B337B34BB33BB337B337B349B357A3B33BB33BB35365F43AB35487B3548DB335B35775B35691B35869B3594D7F5151513451515151345151515151515151515151513451517F7F7F7F");
                    cmd.add("04C83F43F3D544563953633963BC81333633190F7F8848A133353C33679C2E3E3435343433D33333337348B33DB3535FB3543DF4537EB35369B337F44AB33FB353A5B3547FB3544FB33DB353B1B335B35599B35461B35363B3544DB35381B35357B35357B35357B3638951515151345151513451515151515151517F51515151515151AA328233353D3341B67F493435343433D33333335B5370B35D83F45370F455A2B35547F43CF45790B35635B35375B33DB33DB33DB35377B354ADB3573F517F347F34517F347F34");
                    cmd.add("04C83F43F3D544563953633963BC813337335FFF5151515151515151BAD99F33353E33D2D0E1983435343433D333333372548EB35485F453A2B35435B355AFB35D51B3557DB35451B33BB35433B337B35359B3539FF45464B353A7B3536FB35371B335B35471B3544BB341B337B3543D517F345151517F515151515151513451515151516F515151699D7B33353F3394496F133435343433D33333335748B337B35387B3545DB337B3538DB33DB3549FF45396B35633B337F4564EB35471B3656B51515151517F7F5134");
                    cmd.add("04C83F43F3D544563953633963BC813338334F277F515134515108D87033354033460BEF803435343433D33333335058ACB34DB347B35379B35365B343B35F5BB35545B35699F4569CB3556551515151515151517F347F76E2E033354133EC0004223435343437D2AF33338A2D3533995656B34FB349B337B3536FB35853B35759B35955B35561B35361B35379B35363B349B33BB341B341B35353B33BB337B339B33FF438B3535FF43AB337B339F43EB339F45360B33BB341B339B33FB339B35369B35493B3539FB349");
                    cmd.add("04C83F43F3D544563953633963BC8133393357FAB33BB353A9B349B33BB353B15151517F517F7F7F5151515151515151515151515134515134515151345151345151515151517F51515151515151DE1A97333542330BB8BD743435343433D33333336846B33BB341B341B35353B33BB337F438B33FF438B3535FF43AB337B339F43EB339B35753B343B35487B3587DB358B1B3576DB35B35515151515151513451513451513451515134515151517F7F7F51318B653335433372A67BB53435343433D333333349577CB3");
                    cmd.add("04C83F43F3D544563953633963BC81333A3312D75E71B3549DB34FB35935B35733B35591B3543751515151515151D14D5C35354433139885E3393D393C87C3A93FB47FB43369BE5B33813733353333843347748373B16D43E8375433559B7F5333252A8B2F37559A7C987B252ABC2D5F53292ADF2E345343F03D57335343E837543355927F5333252A782F3755917C8F7B252AA92D6053292ACC2E345343F03333BBF03338018A33532356B546539EF6537AB35AA3B335B335B335F434B339B35359F634F434B34BB34F");
                    cmd.add("04C83F43F3D544563953633963BC81333B331908B353ABB3536BB34FB337B3535FB343B34FB34FB343B34FB347B35367B34BB33BB3537FB339B33FB337B33DB34DB335B339B335B35389B33BF53BB335B335B35355B33DB353A7F539F537B349735357B335B33BB33BB337B33DB335B33DB33DB337B33DB33DB337B335B339B335B337B33D7337B33B7335F446B335B335B339B337F4535EF65434F43AB33BB35367B33BB349B335F640B337B341B33DF442F436B33DB343B33BB343B35365F45362B33BB341B33DB343");
                    cmd.add("04C83F43F3D544563953633963BC81333C330378B337B33DB343B3544DF45398B354A1B343B337F44CB343B343B343B33BB335B33FB35357B349B33BB34DB33DB343B33DB35361B337B339B33BF440B35365B3373433512C51515951513451513433512C51345151514551513A4445444445440F44535142424242424242424242423342515151424213333113333113131313131331311313311313311328151534153215351515153232A33318153215151515153233153A1515151532153215151515151532151515");
                    cmd.add("04C83F43F3D544563953633963BC81333D3388C51515151515153215151515321515151515151515151515151515151515153215158024D0353545331841EC61353635375B47D27759357877F8773457647B33AB252AA52C36330EE5335E33046F56497B33AB3433FC39FC429B7934A417E533C7345BB637535CB337F45482B337F436B341B33DB341F636B33BF640F63AF846B349B33BB341B33DF442F436B33DB343B33FB34DB35363B34DF436B33BF43EB339B35353B33DB349B339B35357B35481F436B337B34DB3");
                    cmd.add("04C83F43F3D544563953633963BC81333E335A5643B343B343B33BB33BB335B34BF448B33BB34DB33DB343B33DB33BB33FB35359B337B337F63AB35357B337F4536EB3535DB347B33BB35355B35377B35481B33BB343B33FB33BB349B33BF448B33FB33BF442B347B33BF434B345B33DB33BB33FB345B33BB335B345B33BB33BB3535FB3535FB347B33DB33FB33BB35363B33BB33BB33BB353A5B35369B35357B35359B337B33BB35395B337B33BB35499B347B349B345B339B33BB339B349B33DB33FB33DB349B347B3");
                    cmd.add("04C83F43F3D544563953633963BC81333F337C6B47B341F638B33BB339B349B33DB33FB33BB341B337B33DB33DB3535FB33DB33BB33BB353A3B33BB33BB33BB33DB33BB33BB33BB33BB33BB33BB33BB3535BB339B347B339B33DB33BB33BB345B345B33BB33BB345F44AB33BB33BB33BB33BB33BB33DB33BB33BB33BB33BB33BB351B33DB33BB33BB33BB33BB345B3373482351515321515153233153A153233153A3233153A15333233153A151515151532153215151515151515321515321515151515151515321515");
                    cmd.add("04C83F43F3D544563953633963BC81334033EBD2151515151515151532151515151515151515153233153A151515321515151515151515151515151532151515321515153215151515151515151515151515151515151515151515151515151515151515151515151515151515151515153233153A1515151515151515151515151515151515151515151515151515151515151515151515151515153215151515151515151515151515151515151515DCB547363546336568F37E3738373A423F454FD26A3939353474");
                    cmd.add("04C83F43F3D544563953633963BC8133413373E2A9C7747FF6543453242A6E2D672D9C797BA45B2D4CB6963EB345F434B341F43AF45358B33BB33BF640B33FB34BB339B33BB33BB33BB33BB33BB34DF43AF442B33BB33FB33FB33BB33BB33BB33BB35353B33BB33BB33BB33BB3535BB33BB33BB33BB34FB33BB33BB33BB33BB341B33BB33BB33BB33BB341B33BB33BB33BB33BB337B33DB343B33BB33BB33BB33BB337B33DB343B343B33DB339B33DB33BB343B343B33DB339B33DB33BF44AB337B3538FB337B33DB337");
                    cmd.add("04C83F43F3D544563953633963BC813342338090B347F436B33DF436B349B349B337B33DB337B349B35371B33DB33DB33FB339B34DB33DB349B34FB33DB33FB33DB341B35363B337B33DB337B35355B33BB33BB33FB33BB33BB33DF436B347B33BB33BB353ABB337B33DB337B3535BB33BB33BB33FB33BF43AF43CB337B347B33BB33BB35375B35369B337B337B33BF446B33DB33DB33DB33BB335B3535FB33DB345B343B33BB339F438B33BB33BB33BB33BB33BB343B34BB33DB33DB33BF448B35363B33BB35359B33B");
                    cmd.add("04C83F43F3D544563953633963BC81334333C017B33BB3537BB33DB33BB33BB33BB33FB35355B35389B34BB33BB33BB337F43CB337B35473B343F636B35361B33DB33FB33DB35387B35369B337B337B33BB347B33DB33DB33DB339F634B3535FB33DB343B343B33BB339B339B33BB33BB33BB33BB33BB343B34BF43CB33DB33BB335B349B35363B33BB35359B33BB33BB35381B33BB33BF43AF43AF43EB35355B34B3B9834F3F434F43415153233153A1515151515151515151532153215151515151515151515151515");
                    cmd.add("04C83F43F3D544563953633963BC8133443333DF15151515151515151515151515151515151515151515151515151515151515151515151515151515321515151515151532151532151515151515151515151515151515151515151515151515151515151515153215151515151515151515151515321532151515151515151515153215151515151515151515151532151515151515151515151532151515151515151515151515151515151515321515153233153A15151515151515151515151515153233153A1515");
                    cmd.add("04C83F43F3D544563953633963BC8133453323C6151515151515151515151515153215151515151515151515151515321532153215153BF1D6343547339EDCBEC43435343470D2767034463A333364F23338563A33333333B332B3E83253322A9B3234F063E8B6E39B7B33ABA07C3CABBB753304D2139D7B33AB967C3BA3847D34549B7B222A42B4935388B33BB33BF436B33DF436B35471B343B337B35369B33DB33DF43CF4537CB3536BB349B35397B3537DB35555B343B343B341B351B341B3537FB35473B35367F4");
                    cmd.add("04C83F43F3D544563953633963BC81334633DB2F5378B3538FB3535FB335B335B335B35437B353A3B35355F45362B35355B3536DB33FB35357B35369B341B35387B35433B33DB35357F45354F653AAB35375B34BB35355B35355B349F43AB35375B345F4535EF4536AF446B3536BF63EB3535BB33BB345B33BB35371B33FB353A9B3539BB341B337B343B34BB337B34BB337B339B347B35377B337B339B347B341B33BB33DF43AB339B33DB35393B35387F65015151532151532151515151515153215321515153B1515");
                    cmd.add("04C83F43F3D544563953633963BC81334733600215151515157F15153215156F6F6F6F151515321515151515151515151515323233153A151515151515321515153215321532153233153A15151515153B3B151515151515151515151515151515153B15323B3B3B153233153A7A31D034354833BA3CCAF2343534346FD2776F33F3E5231A368B3353434B3353CA373333A3E84A57CE7B78ABCD7B739BB4ADFCE5CC7B322AF832335B380320E5336035043353EA8133133453F3E5335BB4965382B3546BB35375B343B3");
                    cmd.add("04C83F43F3D544563953633963BC8133483324B43DB335B3544BB35383B35355B3536FB34BB35393B33BB343B35379B343B35375B353A7F440B33FB341B35387B3587BB341B3535FB35367B353A3B339B35483F43AB337B339B345B335F45440F45384B343B3535BB3537FB351B35383B35367F43EB33BB343F45388B33DB335B343B33BB341B339B33DB35375B35361B339B343B33BF442B33FB339B341B343B35363B35353B33BF43AB35361B337B33BB339B35359B339B35365B33FB337B35365B339B33BB33BB353");
                    cmd.add("04C83F43F3D544563953633963BC813349336FEF61B33BB339B33FB33FB341B335B34FB33DB343B35353B341B337B33DB343B337B33D3B3B15153B3B15157F15151515153B3B3B1532151515151515153B151515321515157F7F347F343B15151515151532151515327F151515151515153B15151515321515151515151515321515151515151515151515151515151515151515151515151515151515158B5EC034354933318723933435343471D2756F33CC2B677B43237F2E5154335565805B33212AC32BB7555433");
                    cmd.add("04C83F43F3D544563953633963BC81334A3339E45B7B202AF431242AD32B64F04583333443E8335533545453242AB73037333353F376B775A72CB4805374B33DB343B337F43CB343B343F43EF45378B355A7B343B35465F45374B335B35375B335B33FF45434B33FB347B35391B335B337B3536DF436B35381B335B337B335B335B335B33DB33DB3536BF444B339F43AB335B339B35387B35353B337F4537CB3538BB335B3536DB335B337B335B3575BB35359B339B335F438B337B339F434B337F442B33BF43EF448B3");
                    cmd.add("04C83F43F3D544563953633963BC81334B339ACB545DF434B35691B349B3536BB353A5B347B33BB33DB33DF43CF436B33DF43CF43AB337B35353B353A9B35359B339B35467B335B3535BF442B335B335B3536B1515151532151515327F3415151515321515151515321515151515151532151515151515153B15153215153215151515153B34151515151515153B151515323B3B1532151532151532153215153215151515151515151532153215153215321515151515151515153215151576BBD434354A3302D2460D");
                    cmd.add("04C83F43F3D544563953633963BC81334C33DAC0343534346FD2776F333413272AB12CE81A4423082B1C2AA12B3E235E2BE11A2A2AF02BDE1A3D237B31F07C3BA3D91AD81A3323F92E33534023EA2D3353EC7C3BB33353EC7CB4965374B34DB335B3535FB33FB335B349B335B3536BB33BF43CB337B33DB33DB33BF63AB335B339B343B335B335B335B339B33DB33DB33DB341B33DB33DF436B339B341B33FB33BB33BB33BB35359B33BB33BB3535DB351B35355B35371B341F450F43EB335B339B349B335B335B3535B");
                    cmd.add("04C83F43F3D544563953633963BC81334D33E38FB3556BB33FB33BB343B33BB3537DB35377B33DB35353B34DB35355B35367B343B343B3536BB35361B33DB3536FB343B33FB345B35359B33FB345B33FB33FB35453B35361B355A9B33FB343B35371B347B3589BB35361B3538FB35379B3543BB35385B351B35387B34FB337B335B3536FF64AB33B151515153B151515151532151515153233153A15151515153B15153B15151515153215151515151515151515151515151532153215153B1515151515151515151515");
                    cmd.add("04C83F43F3D544563953633963BC81334E3300E1151515151515151515151515151515151515151515153B1515153B3B3B3B15151515157F7F3233153A1553C4F934354B33754F36923435343474D27274383A3334574713F2E59C793CAB38558476AC4B29E5BC4C734B35CD17E520E554339C76854B20E55C33BCE51E2A4A31974F17E54C5F3E0D33559451FCE53353222AB0B4A85386B339B335B35375B35381B34BB35365B345F444B35365B345B337B33FF44AB33DB343B3536DB349B33DF45356B345B34FB35361");
                    cmd.add("04C83F43F3D544563953633963BC81334F337D31B34FB345B3537BB3536FB3535DF43CF43CF43CF43CB33DB33DB33DB33DB33DB33DB3536DB33FF446B351B35487B35369B35433F434B353A7B33BB35355B34BF442B3535FB33DF43CB33DB33DB33DB33DB33DB33DB33DF43CF43CF43CB33DF43CB33DB33DB33DB35357B3535BB35369B35377B34BB3535FB35393B35377B35441F45360B34FB35449B339B3536BB33BB34FF438B34BB35367B349B3535FB353A7B35355F43EB34FB35471F453A4B35361F4535EB34DB3");
                    cmd.add("04C83F43F3D544563953633963BC81335033EC18535FB35435B35391B34D7F7F7F15151515153215151515153215151515151532151515151515151515321532153215321515151515151515153215153B3B7F347F1515151532151515321515151515151515321532153215153215151515151515151515157F7F343B151515151515321515151515157F343B157F341515321515151515EA909F34354C33138C4A01353635376E3ED26D6E33837E0374FCE537CBB3AC212ACC305CAB9DAB4539453F4476BCE5734B34");
                    cmd.add("04C83F43F3D544563953633963BC81335133A47AC36D33DCABBCE534CB1D2A4E31DBAB574BDBAB724BA94F37CB73AC29E5E375130536B472558EB34DB35373F438B343B335B335B341B35543B35363B35359B3535DB35353B343F45372B35357F440B34FB35561B349B3537DB351B33DB347B34DB3548DB345B34DB35363B35369B347B35363B35355B35367B3543DB349B335F454B0B349B347B341B3536DB34BF4535CB35359B35359B354A1B341B3536FB35353B35353F646B343B341B35391B34FB349B33BB339B3");
                    cmd.add("04C83F43F3D544563953633963BC81335233276741B3535DB349B33DF43AB349F45356B34BB3537FB35361B33BB35399B35375B339B35353B35375B349B33BB33715151532157F7F7F7F151515153B153215153215153B151515151515151515151515151515157F7F34151515151515321515157F7F3B153233153A1515151515151515151515153215153215157F15151515157F7F1515CE649F34354D333285CF33343534346FD2776F33F3E565F023E8BEE3335733533BC333539C793BA3335333539C797BA33358");
                    cmd.add("04C83F43F3D544563953633963BC81335333862633573254BC333355EC7F53331D2AB62B4054335534DF53331D2AB02B3353B47153ACB3538BB35357B35355B343F45452F45372B35551B35467F45370B354A7B3537FB345B345B345B345B343B35543B35371B35357F43CF45486B35583B35379B339B339B339B35383B3536DF436B33DF45438B339B341B33DB35359B335B343B3536DB3535FF44EF442B35371B35355F442F43CF438B341B347B34BB33FB351B349B35391B35361B345B33DB339B33FB33BB339B353");
                    cmd.add("04C83F43F3D544563953633963BC813354335DF253B33FB35377F4535CB3535BB3535BB33DB339B33FB351B33FB35373B3535DB3535BB347F434F450151515151532153215151532151515151515151515151532153215151515151515153215153215151515151515151532153215157F341532153215151515151515157F1515151515151515153215151515151515151515157F347F345CF4ED34354E3323B56B2135363537594FD2715933747DF47743769C793BB35B33977C1C2A512B40335B33BA543C341C2A4B");
                    cmd.add("04C83F43F3D544563953633963BC81335533D20C2B373335CB927C1C2A462B35C4B4AF535EF634B335F4347351F6535AF45396B33BB33DB33DB3537FB3539FB33BB33DB33DB3537FB35373F4535CB349B35435B33FB35443F45370B343B347B35355F45378B33BB33BB339B347B35377F444B34FB35365B337B34DB3535BB337F638B35383B353B1B3537BF442B33DB3535FB343B339B3535BB343B347B35355B3535FB341B343B35357B34BB33DB35369B33DB3536DB347B35373B33FB35379B337B35381B349B35459");
                    cmd.add("04C83F43F3D544563953633963BC81335633F61CB35359B3537FB337B3545FB35367B349B345B3536BF64CB33BF440B33DB339B343B337B343B335B337B35381B341B35353B345B35367F4535EB35371B3535FB339B335F45386B33FB349B343B341B343B337B354773433852C4F13343233153A1532151515151515151515157F341515151515321515151532151515151515321515151515153233153A15151515321515151515151515151515151515151515151515151515151515151515151515153233153A157F");
                    cmd.add("04C83F43F3D544563953633963BC81335733CA3B3415151515151515151515151515321515157F7F3415151515151515A82B7F34354F331854DD42363736394E3D4BD2763F42337CA1737EFD6B941A9B7933AD405B3E043C5720E532603304861AA051841A335328B46B5366F43EB35389B35387B345B35437B353A1B35385B345B353A1B35481B33FB34BF43EF43EF45362F45398B33FB347B33FB33FB343B337B3545DF43EB3537DF4537AB3536DB345B353B1B3539FB3536BB345B3539DB3547DB33FB34BB33FB33F");
                    cmd.add("04C83F43F3D544563953633963BC81335833E07EB35361B353A1B351B3535FB339B351F44EF446F446B343B34FB34FB34BB34FB35363B35357B3535FB33FB341B35373B33FB341F45354B33DF45376B33FB33DB34DB33DB33FB347B33FB33FB3547FF43AF45372B33BB3567BBD3515151515151515151515151532153215327F34151515151515151532151532151515151515151515151515157F15151515153215321532151515151515151515151515151532151532151515151515151515153215321515D35E9434");
                    cmd.add("04C83F43F3D544563953633963BC81335933210635503325551B88343534346FD2776F337B7BB47553037B7BB47550037A7BB4754D037A7BB4754A03797BB4754703797BB4754403787BB4754103787BB4753E03777BB4753B03777BB4753803B46C5686B35353F43AB33FB35357B3539BB33BB33FB353AFB33BF43EB35561B33BB3538BB33BB34BB33BB33BB3536FB35457B33FB33FB33FB341B35373F45396B35375B35479F440B351B35387F4558AF434B33FB337B35355B335B347B35357B33FB33FB33FB345F440");
                    cmd.add("04C83F43F3D544563953633963BC81335A33B6E8B35381B335B347F4535AB339B35365B349B3535BB335B34DB35383B351B35545B335B335B335B3538BB35453B35363B34BB33BB335B335B335B35369B3537FB335B34BB343B33DB33BB35375B335F45366151532151515151515151532151515151515151515151515151515321515153215157F341532151515151515151515151532151515153215157F7F151515151515151515157F151515151515151515151515151515329A9F7C35355133CA25B27D35363537");
                    cmd.add("04C83F43F3D544563953633963BC81335B33ECD24C56D2773847899C099C43E8767B761D8A3353FC8B3353B3E8343333533B33212AC532B59346B335F537F45372B335B34BB3535BB347B35359B335B35355B3536BB335B34BB347B33BB347B33BB34BF45358B335B3536BB351B35379B35381B33DB34FB34BB35357B33DB33DB343B339B33BB33BB35361B35357F434B351B34DB33DB341B337B343B34BB3535FB343B337B341B33DB35363B335B35353B339B33FB33BB33BB341B353A3B33DF446B351F448B345B34F");
                    cmd.add("04C83F43F3D544563953633963BC81335C335FDDB33FB35375B351B335B34DF446B351B35363B337B33BB343B339B341B34DF43AF43CF438F43AF444B33DB35355B335B337B34DB33BB341B337F43AF43AB349F43AB335B34FB35363B339B35385B33DB33DB33BF45382F434F446B34DB347B347B347B35361B345F434B35397B335B34BF4536AB33FB33DB349B335B3537BF440B35373B335B34BB34FB33BB347B33BB347B347B3535DB345B335B35373B33DB33DB33BB35367B335B347B341F4536AB33FB349B335B3");
                    cmd.add("04C83F43F3D544563953633963BC81335D33130135B351B34BB339B33FB35395B34FB3536FB353A9B35387B33F066733F9E538151515151515157F15151515151515153215151515151515157F1515151515157F7F15321515151515151515151515151515151515151515151515321515321515157F151515153215151515151515151532153215321532153215151515151515151532153215153215151515151515157F34153215321515151515151532151515153215153B151515327F1515151515151515151515");
                    cmd.add("04C83F43F3D544563953633963BC81335E3392D4151515157F151515153215153B15157F15151515157F7F1528BA2C35355233F13188123435343473D2736F33EF893353B3E83453BC7C3BA3AF7D3454BB7B172A5631AD7B33AB335B38033454AA7B182AF42B335B35046353A77C3BA3B47E6F55375434532B2A5D2F212B335BB6715398F452B351B35375B335B35357F43AF43AB339B337B3536BB343B33FB33DB345B335F440F434B3538BB339B33DB35359B335B35357B33BB33BB339B337B35373B33FB339B335B3");
                    cmd.add("04C83F43F3D544563953633963BC81335F33A1B247B349B335B335B335B3535FB3536BB35387B335B34BB35357B335B3538DB3536FB33BB35359B335B34BB34FB345B335B35359B35383F446B33FB35359B33BF43CB33FB35369B33FB35355B347B34BB3538BB33BB351B351B351B339B35361B3535DB35395B33DB33DB33DB33DB33DB33DB33DB33DB33DB33DB33DB33BB33BB33BB33BB33DB33DB33DB33BB33DB33BB33DB33BB33DB33BB33BB33DB33BF43AF43CF448F444B33DB337B339B339B339B339B339B339B3");
                    cmd.add("04C83F43F3D544563953633963BC8133603336A33DB339B33DF448B335B347B345B33DB343B34BB343B34DB33DB33DB33DB33DB33BB33DB35365B33DB33BB33DB33BB33DB33DB345F43CF43CF444B345B34BB33DB33BB34BB335B33DB3537DB33DB341B339B339F43CB33DB335B35357B33DB33DB33DF45386B33DB349F434B339B335B339B339B335B349B339B33DF434F434F4535AB33DB33DB33DB33DB33BB33DB33BB33DB33BB33DB33BB33DB33BB33DB33BB33BB339B335B335B339F434B339B335B339B335B341");
                    cmd.add("04C83F43F3D544563953633963BC81336133BA2CB35381B343B343B3537D1532156F1515153215321515153B15153B151532153215156F6F151515151515151515153B3B151515157F15151515151515157F1515151515157F153215151515321515151515151515151515157F15151515151515151515151515151515153B15151515153B151515151515153215321532153215157F7F7F7F7F7F7F7F7F7F347F7F1515153B3B3B15151515153B1515153B153B153B1532153215323B1515151515151515157F7F7F34");
                    cmd.add("04C83F43F3D544563953633963BC813362338DA97F7F7F151515153215157F347F7F7F7F7F7F7F7F7F347F347F341515151515151515153B153B153B153B7F7F7F7F7F347F7F7F7F7F7F1515154222EF343553338FBE916436373638444B53D26A4333347451F3ADCA40043855CC545333172A1A2B335B39042BB53C4AB3367435B343B337B35363B351B33DB339B339B35359B343B349B35359B35359B35359B33FB34BB33FB35375F438F43EB3536FB35363B349B34DB35369B33FF64AB35365B33DF63EB35353B341");
                    cmd.add("04C83F43F3D544563953633963BC813363338A7DB339B3536FB3536DB35463B35355B3535FB343B35355B3535BB3535FB353A7F4535AB3535DF442F4535EB341B343B341B35363F43CF448F440B35361B341B35357B3535DB3539BB33FB343B33FB35353B35373B35497F4544EB34DB35391B341B35355B35353B3536DB33BB33BB33DB35367B33DB33DF43CB33DF442F45356B343B3535DF43EB339F450B341F446F440B33BF43EB35447B35355B34FB349B343B339B35353B3535BB3535DB33FB33FB33BF45436B341");
                    cmd.add("04C83F43F3D544563953633963BC8133643338A4B3548BB3377A343140157F6F7F7F1515151515151515157F347F341515151515153233153A7F153233153A1515151515151515151515151515321515321532151515151532153215321515151515151515151515153215151515151515151515151515321515321532151515323B15321515321532151532153B1515153B1515151515151532157F150DAB0934355433BA8ABDC5343534346FD2776F332831325B34043A53021338539C793BA341DB73AB7351B3E5D2");
                    cmd.add("04C83F43F3D544563953633963BC81336533846A7C7476D27B3B4B3CCC794B3353F382F21341CB333FF27CBB75370341CB333FF07CBB75B533544AB343B3556BF43AF4537AF434B34BB341B347B33DB339F44AB341B33DB33DB339B33DB33DB33DB33DB337F444B335F450B339B339B35371B33FB343B33DB339B33FB3535BB35385B33FB35353B3537BB35377B341B351B33FB341B35373B35395B35371B3535DB347B3535FB3538BF4544CB35487B3535DB337B34FB335B335B335B335B335B337B34DB337F434F436");
                    cmd.add("04C83F43F3D544563953633963BC8133663383F6F4537AB35375B335F434B35365B335B3546FB335B335B35369B335B3543BB335B35359B3538BB33DB33BB33DB343B33BB33DB33FB337B33DB343B34BB33BB33FB33FF45362B33DB35365B35355B35383B345B33DF43CB33DF440B335B33FB345B3565DB33BF638B345B33BF638B3393B15153215326F346F151515157F3415151515151515153B15323B7F343B3B153B3B7F153B3B153B3B7F1515151515151515151515151532151515151515151515151515153215");
                    cmd.add("04C83F43F3D544563953633963BC8133673353B132153215151532151515151515151515151515151515151515151515151515151532151515151515153215153215151515153233153A15153233153A158F25C13435553372CB0C893435343474D2727438BB75340333533313345349F02BE8383341334733322AFF32335B3804B3543355CE826B33152AB92B17E555335C33CB7B29E5B74C5333142AF432B154C77B152A37B48A5382B33BB33BB34BB335B35365B347B35393F45356F45372B33DB341B33BB339B353");
                    cmd.add("04C83F43F3D544563953633963BC81336833A0187FB33BB33FB351B3537BB3537DB345B33FB349B339B345B339B34FF448B33BB33DB349B33FB35355B35359B35359B35357B3538BB353A7B35463B354A7B35469B3539DF438B35355B35441B35399B339B337B343B33DB33FB35361B3535DB35377F43AB3535BB33BB33BB347B34DB35393B3535DB35377B33BB3535BF43AB33BB347B34DF45392F4535AB33BB349B33BB33DB35363B33DB34FB341B35435B345B33FB35457B33BB3555BB35359B35361B35367B34515");
                    cmd.add("04C83F43F3D544563953633963BC81336933EDE51515153B151515321532151515153B151515157F151515151515151532151515151515151515151515151515321515151515151515151515153215153B1515151515151515323B1515153215321515153B151515153B15151515151515151552B2983435563335864B583435343473D2736F333BA364F047513353768B335323563353A3B333384D5733531DB4333808503353095033535E4F33537B8B3353604F3353F2503353F150335343E8B5E36C2C3833B46953");
                    cmd.add("04C83F43F3D544563953633963BC81336A33320676B3543FB335B33BB33BB3543DB35355B35469B33BB3535BF45488B34BF45396B33BB35367B33BB345B35391B341B35565B34FB35589B337B34BB33DB335F43EB33DB3535BB354ADB349F44AB343B34BB347B347B347B34DB34BB35371B3537FB3535FB3535BB3535DB34BB34BB347B35457B34BB33DF43EB33DB33FF442B349B343B347B33BB34DB335F648B33FB33FB33FB33DB33FB343B349B343B34FB35439B3544DB35377F6535AB35379B353A5B343B353AD15");
                    cmd.add("04C83F43F3D544563953633963BC81336B33E94315151515151515151532157F341515151515151515151515151515321515151515321515151515151515151515151515151515151532151515321515151515153233153A1515151515151515151515153233153A15153B1523CE6534355733B7534F45343534346FD2776F3320E56B33F3E5132A782C5B4B355B06049B7973AB335BF7039B79B3AB9C79BBB59B799C79BCBD3C3532E5FC4CB4B53353571339DE05E5355888768E4CB44F5494B33FB35371B35459B33F");
                    cmd.add("04C83F43F3D544563953633963BC81336C33494FF45534B3536BB35375B33DB35385F45370B33FB33FB33FB341B341B341B341B341B35499B35375B35367B35363B3543FB339B35353B35353F45358F44AB354A3B335B3548FB33DB33DB3535BB337B3536DB35449B341B3535FB35353B3536BB34FB33FB33FB33FB349B33BB337B341B3539BB33FB35359B33FB3538BB347B354A3F45374F45376B3537DB35573F4544C1515151515321515151515321515151515151515153B15153B15151515321532156F6F151515");
                    cmd.add("04C83F43F3D544563953633963BC81336D33F222151515153B6F15153B3B3B3B151515151515151515157F347F343B3B153256E9EC333558337D1598FE353635355D45D277474953D373513F037351375B7C0CF352345B3F0C821339556B3276133955AE7BF3B0345B34043A554313AB7BF3B0824CF9544BB3544BB339B3535BB341B35391B35965B3576DB347B35367B35393B343B35A51F4539AB35445B3536BB3536BB343B35371B35355B33DB35535B35397B3536DB345F442B35369F642B3535F5733573330332F");
                    cmd.add("04C83F43F3D544563953633963BC81336E334A3415151515153B3B153B153B151532156F1515151515151515157F34153233153A1505FBF435355933DAACB8FC3537353674C999BB8C6F3433898A33535BA31D2A2130393333531D2A203029E533613604335733535BA3491329E53461350434535BA3431329E53661350432535BA33D1329E563613A04A4762B4613B63F5378B34DB35375B335B337F43CB35479B3535FB347F45374B35383F45370B3535FB335F45360B349B34DB35389B343B345F44CF43EB33BB347");
                    cmd.add("04C83F43F3D544563953633963BC81336F3398E6B335B33BB35365B35361B335F44CB343B33BB35393B34DB343F434F434B33BB33BB341B35373B33FB33FF43EF43CF44EB33FB33FB33FB33DB35353B33FB33FB33FB33FB33DB345B33FB33FB33FB33FB33DB35355B33FB33FB33FB33DB3537FB35355B35355B3536BB35383B3536BB34DB337B33BB33FB335B3535FB343B337B35437B335B339B33FB337F438B337B339B337B335B337B33FB337B339B337B339B337B335B337B337B339B337F53BB337F53BB337F53B");
                    cmd.add("04C83F43F3D544563953633963BC813370332F3BB337B33BB339B337B339B337B337B337B33FB337B335B335B335B335B335B337F535B337B337B335F535B335B335B33DB337B345B33BB335B34FB335B33DB339B335F438B35357B33FF636F64EB335B335B335B335B33DB33BF43AB35447B34BB33DF442B33DB33DB33DB33DB33DB33BB33BB345B33DB345B33DB33DB33BB335F43CB337B339B33DB33FB33BB341F440B3559FB351B3538BB34DB3535715153B157F347F15151532151532157F7F341515157F151532");
                    cmd.add("04C83F43F3D544563953633963BC813371331C8E153215151515151515153215151515151532153215151515151515321532153215151515151515151515151515151515151515151515151515157F15151515151515151515151537153237153715371537153715371515371537153337371533373715333737151537153715371537151515153B3737333715371537333715153737157F151515151515153215153433C437343318380D0D0D0D0D0D0D320D0D0D0D320D0D0D0D0D0D0D0D0D0D0D0D0D0D0D320D0D0D");
                    cmd.add("04C83F43F3D544563953633963BC813372330B890D0D0D0D320D0D0D0D0DC1FA2335355A3322DAC52A343534347FD2677F33497BF3AD345B3E043353477CFBA55253322AB531E57B3323412E3453142A652B35133353467C3BA3457B33AB734F447C3BA334F04D503353528B3353EF50335367503353F250335366503353B6545452F438B33FB33FB339B33FB347B351B347B349B341B34FB35353B349B341B35395F446B35369B3535DB347B33FB33BB33BB33BB34FB337F440B35355F6535AB35357B343B343B351B3");
                    cmd.add("04C83F43F3D544563953633963BC813373335B055359B35357F43CB339B349B33FB339B33BB33BB3537DB339B343B33BB33BB33BB35359B343B343B347B345B33FB34BB35353B33FB349F44CB34BB341B33FF43AB33FB33BB341B33FB33FB33FB341B341B341B341B35537F43CF448F43CB34FB33BB33FB34FB347B341B35357B33BB335B341F448F43EB3535DB343B33DB34BB337B33DF43CB337B33DF43AB337B335F43EB351B33BF436B335B34FB34BB33DB337B33DB33DB337B33BB337B335B3535FF450F434B33D");
                    cmd.add("04C83F43F3D544563953633963BC81337433CF6BB335B33DB341B335B337B335B349B34FB33BB33BB335F634B34DB351B33BB337B335F45358B34FB33BF436B335B347B35357B337B335B341B35357B337B341B35353F65356B337B341B349B351B33BB337F434B349B349B33DB33DB33DB341B335B337B335F45356B34DF838B341B343B3537DB33BB34BB339F44EF64EF444B33BB33DB337B33BB33DB337B33BB335B3537DF4537AB345B341B35363B341B337F40D320D0D2B0D0D0D0D0D0D0D0D0D0D0D0D320D0D0D");
                    cmd.add("04C83F43F3D544563953633963BC81337533C49C0D0D0D0D0D0D0D320D32330D3A0D0D0D0D0D0D0D322B0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D320D0D0D0D320D0D0D0D0D0D0D0D0D0D0D0D327F340D320D2B0D2B0D0D0D0D0D0D0D320D322B2B2B0D2B2B0D322B2B0D320D0D0D320D0D0D320D0D0D0D0D2B0D0D2B0D0D0D0D320D320D0D0D0D0D0D0D0D0D0D0D0D32330D3A0D0D0D0D0D0D320D0D0D320D0D0D0D0D0D0D0D0D0D32330D3A0D0D0D0D0D0D0D320D0D0D0D0D0D0D0D0D0D320D2B333233");
                    cmd.add("04C83F43F3D544563953633963BC813376330C1F0D3A2B2B2B0D0D0D0D3232330D3A0D320D0D0D2B0D0D2B0D0D7F340D0D0D0D0D0D33B9A0AB34355B338D8CCB583435343484D2628236BF7C3CABF3E5B47535038D5733138D5717E5335F6B03AE7D3754D67B0E2A6D32335B390437559C79C97F53330E2AF93248133654A67B0F2A4530A57CFCABF3E5B475390337559C79C17F53330E2AE9552BB46A538EB337B335F6537AB339B335B35361B335B34DB335B35365B349B35367B339B347B3535BB35353F44CB341B3");
                    cmd.add("04C83F43F3D544563953633963BC813377333D485359B347B35395F45364B345B3537FB349B35377F440B341B343F43CB33BB337B343B33FB33DB33DB341B35561B35579B3536FB35469F45370F4545AB3546BB35449F45454B347B349B35355B3538BB35437F4536AB35375B347B34FB343B351B34FB35385B35373B33FB35369F64CF4539EB3547BB3535FF4536EB343B35355B34BB339B343B347B33B0D0D32330D3A0D0D0D2B0D2B2B0D0D0D0D2B0D0D320D0D0D0D7F340D0D0D0D0D320D0D0D320D0D0D0D0D0D0D");
                    cmd.add("04C83F43F3D544563953633963BC81337833A9970D0D0D0D0D320D320D0D7F340D0D0D0D0D0D320D0D0D0D0D0D0D0D0D0D32330D3A0D320D0D0D322B0D0D0D0D0D0DCF28E634355C33AECCFCC8343534347FD2677F333D33FE4A493352339B7936FB3D553356112A7F2CB34CAC749D7936F53B6D974F17E5395FFD0E38559C7935DF53330D2AF832345539DC35DF975053330D2AF1323955A87C35DB322A2C2B3BE3B491539CF452B35353B33BB337B35365B33DB35371F63CF644B33DB35451B35373B35355B339B357");
                    cmd.add("04C83F43F3D544563953633963BC8133793320D54DB34DB339B339F45834F45364B35381B33DB35381F453ACB35393B343B33BF440B343B337B335B3536FB341B347B33BB343B33BB339B337B3535BB33DB33FB33FB33BB33DB343B33BB337B335B34DF4536CB347B341B351B341B35357F45450F440B3535BB35361B335B35357B3537DB33BB33DB33FB33BB347B341B34FB33BB347B345B35373B345F45368F440B33BF452B347B33BF438B337F4536CF452B35359B33FB3536FB35353B3537DB33FB33BB345B33BB3");
                    cmd.add("04C83F43F3D544563953633963BC81337A33433453550D320D0D0D0D0D0D32330D3A32330D3A0D0D2B7F0D0D0D0D0D7F347F347F0D0D0D320D0D0D0D320D0D2B0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D2B0D7F342B0D0D0D0D0D320D320D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D320D320D0D320D0D0D320D0D320D320D0D0D0D0D0D0D0D0D0DCD4ADB33355D33A9A70169343534347FD2677F33FF8833533459F758787BB7A58F1336CB777CBB7540045159B758375536DC757F53330C2AFE32747D4D54747B0C");
                    cmd.add("04C83F43F3D544563953633963BC81337B33EBC82A49317D1336CB727CBB757404727B739B41630D2AE532707CBB755D046E7B6453A2B33FB33BB33DB3536FB35355B33BB3548BB35535B358AFB339B35361B35357B3535BB35557F638B35635B33DF4608C0D0D0D0D2B0D0D0D0D0D0D0D0D0D32330D3A0D2B0D3284983934355E33DAAD2FE9343534347FD2677F33672C3342C1DB3CC94BCB4114EE409DB26070A03BCA9F97C4348F961927849E9E95949F4F0B6398B88133952520C8399FAED8344EF4273BB58AF742");
                    cmd.add("04C83F43F3D544563953633963BC81337C330B2128F90CE398831CEA451DEBF1BEAFBBEC2F9A5892B341B341B341B341B341B341F440F440F440F440F440B341B341B341B341B341B341B341F440B341B341B341B341B341B341B341B341B341F440F440F440F440B341B35361B341B341B341B341B341B341B341B341B36655F436B33FB35435F438F444B3396F6F6F6F6F6F6F346F346F346F346F346F6F6F6F6F6F6F6F346F6F6F6F6F6F6F6F6F6F346F346F346F346F6F1D3F6F6F6F6F6F6F6F0D320D2B0D320D32");
                    cmd.add("04C83F43F3D544563953633963BC81337D335DBD2BA73FC633355F33505FAA1A353635354078D26140335AD4D92B355B65046C7B6C7C3B936D7A46B337B337B335F537B337B337B337B339B335B3684FF43CB33DB33DB33DB33DB33DB33DF43CB33DB33DF43CF43CB33DB33DB33DB33DB33DB35989B35389B339B351B339B3539D4C4D4C43334D4C4D4C4D4D4D6F346F6F6F6F6F6F6F346F6F6F346F346F6F6F6F6F7F7F7F7F7F7FF24B9034356033777496393839383D3745474345D26733333333377B8BFA817A83FA");
                    cmd.add("04C83F43F3D544563953633963BC81337E3350FB83F43D66333933B4735AA2B335B335B335B335B335B335F434B335B335B335B335B335B335B335B335B335B335B335B335B335F434B335B335B335B335B335B335B335B335F434F434F434F434B335B335B3554DB341F438B349B339B339B339B341B349B339B35441B33DB33DB33DB33DB33DB33DB33DB33DB33DF444F444F45A68F434B335F434B335F434F434F434B335B335F434B335F438B339B339B339B339F438F438B339B336B336B336B336B336F435B336");
                    cmd.add("04C83F43F3D544563953633963BC81337F3300F5F435F435B336B35796B3539DB336B355B1B3516F6F6F6F6F6F6F346F6F6F6F6F6F6F6F6F6F6F6F6F6F346F6F6F6F6F6F6F6F6F346F346F346F346F6F6F6F7F346F7F7F7F6F6F7F7F7F7F7F7F7F7F7F7F7F7F347F347F346F347F7F346F7F347F347F347F7F7F347F7F347F7F7F7F7F347F347F7F6F6F6F6F6F346F6F346F346F6F3434E70D3BE9B833356133CD832948343534347FD2677F33B3E8F379F379357D44334B53DEF12E1A5933353333337CEC33383F354B");
                    cmd.add("04C73F43F3D544563953633963BC81338033B1412734343388EC33383F354B2734333366C8333870C83338D8C83338C9C83338D3C83338DDC833383B3C3D4B4C4E47484B573AB335B335B335B335B335B335B335F4556CF43CB36C456F6F6F6F6F6F6F6F346F347FCBE23A33336233E2B93A3333633329C33A3333643361BC3A3333653379D63A33336633D1ED3A33336733C92A3A3333683381213A3333693359F73A33336A3331103A33336B3369913A33336C33217A3A33336D33B9A03A33336E3391A728573A05");
                    cmd.add("041A4143F3D544563953633963BCA66A333328573A05CCCCCCCCCCCC");
                    index = 0;
                    currentSendOrder = "11";//随便大的
                    if (!TextUtils.isEmpty(currentSendOrder)) {
                        if (CheckUtils.isHexNum(currentSendOrder)) {
                            dialog.show();
                            bleFlag = false;
                            regainBleDataCount = 0;
                            currentRevice = "";

                            sendData();
                            handler.postDelayed(checkConnetRunnable, 5000);
                        } else {
                            Toast.makeText(MainActivity.this, "请输入十六进制指令", Toast.LENGTH_SHORT).show();
                        }
                    } else {
                        Toast.makeText(MainActivity.this, "请输入指令", Toast.LENGTH_SHORT).show();
                    }
                } else {
                    Toast.makeText(MainActivity.this, "请连接蓝牙", Toast.LENGTH_SHORT).show();
                }
                break;
            case R.id.btn_disconnect://断开电表
                if (bleConnectUtil.isConnected()) {
                    handler.sendEmptyMessage(1111);
                } else {
                    Toast.makeText(MainActivity.this, "请连接蓝牙", Toast.LENGTH_SHORT).show();
                }
                break;
            default:
                break;
        }
    }

    //蓝牙连接部分
    @Subscribe(threadMode = ThreadMode.MAIN)
    public void onEvent(EventMsg eventMsg) {
        switch (eventMsg.getMsg()) {
            case Constants.BLE_CONNECTION_FINISH_MSG:
                //蓝牙连接完成
                if (dialog != null) {
                    dialog.dismiss();
                }
                bleConnectUtil.stopScan();

                if (bleConnectUtil.isConnected()) {
                    Toast.makeText(MainActivity.this, "连接成功", Toast.LENGTH_SHORT).show();
                    tvBleName.setVisibility(View.VISIBLE);
                    bleConnectUtil.setCallback(blecallback);
                } else {
                    Toast.makeText(MainActivity.this, "连接失败", Toast.LENGTH_SHORT).show();
                }
                break;
            default:
                break;
        }
    }

    /**
     * 设置回调方法
     */
    private BleConnectionCallBack blecallback = new BleConnectionCallBack() {

        @Override
        public void onRecive(BluetoothGattCharacteristic data_char) {
            bleFlag = true;
            handler.removeCallbacks(checkConnetRunnable);
            //收到的数据
            byte[] receive_byte = data_char.getValue();
            String str = CheckUtils.byte2hex(receive_byte).toString();
            Message message = new Message();
            message.obj = str;
            message.what = 10;
            handler.sendMessage(message);
        }

        @Override
        public void onSuccessSend() {
            //数据发送成功
            Log.i("系统", "发送成功");
        }

        @Override

        public void onDisconnect() {
            //设备断开连接
            Message message = new Message();
            message.what = 1111;
            handler.sendMessage(message);
            Log.i("系统", "断开蓝牙链接");
        }
    };

    private void sendData() {
        currentSendOrder = CheckUtils.getFullData((String) cmd.get(index));
//        final boolean[] isSuccess = new boolean[1];

        sData = CheckUtils.hex2byte(currentSendOrder);
        mBluetoothGattCharacteristic.setValue(sData);
        Log.i("1110", "发送第" + index + "\t" + cmd.get(index));
//        isSuccess[0] =
        bleConnectUtil.sendData(mBluetoothGattCharacteristic);
    }

    /**
     * 蓝牙连接检测线程
     */
    Runnable checkConnetRunnable = new Runnable() {
        @Override
        public void run() {
            // TODO Auto-generated method stub
            if (index == cmd.size() - 1) return;
            sendData();
            regainBleDataCount = 0;
            handler.postDelayed(checkConnetRunnable, 5000);
        }
    };

    //    退出软件--注销广播
    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (bleConnectUtil != null) {
            bleConnectUtil.disConnect();
        }
        EventBus.getDefault().unregister(this);

        if (mLocationBroadcastReceiver.getStatus() == true) {
            unregisterReceiver(mLocationBroadcastReceiver);
            mLocationBroadcastReceiver.setStatus(false);
        }
        if (mBroadcastReceiver.getStatus() == true) {
            unregisterReceiver(mBroadcastReceiver);
            mBroadcastReceiver.setStatus(false);
        }
    }

    //region 关于两个广播
    private class BLeBroadcastReceiver extends BroadcastReceiver {
        private boolean status = false;

        public void setStatus(boolean status) {
            this.status = status;
        }

        public boolean getStatus() {
            return status;
        }

        @Override
        public void onReceive(Context context, Intent intent) {
            checkBluetoothStatus();
        }
    }

    private class LocationBroadcastReceiver extends BroadcastReceiver {
        private boolean status = false;

        public void setStatus(boolean status) {
            this.status = status;
        }

        public boolean getStatus() {
            return status;
        }

        @Override
        public void onReceive(Context context, Intent intent) {
            checkLocationStats();
        }
    }

    //endregion

    //region 检测硬件是否支持，状态是否打开的问题

    //检测设备是否支持BLE
    private void checkDeviceSupport() {
        if (!getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)) {
            Toast.makeText(this, "设备不支持", Toast.LENGTH_SHORT).show();
            finish();
        }
    }

    //检测蓝牙状态
    private void checkBluetoothStatus() {
        if (BleConnectUtil.mBluetoothAdapter == null || !BleConnectUtil.mBluetoothAdapter.isEnabled()) {
            llBlueStatus.setVisibility(View.VISIBLE);
        } else {
            llBlueStatus.setVisibility(View.GONE);
            if (mBroadcastReceiver.getStatus() == true) {
                unregisterReceiver(mBroadcastReceiver);
                mBroadcastReceiver.setStatus(false);
            }
        }
    }

    //    检测定位状态
    private void checkLocationStats() {
        if (!((LocationManager) (this.getSystemService(Context.LOCATION_SERVICE))).isProviderEnabled(LocationManager.GPS_PROVIDER)) {
            llLocationStatus.setVisibility(View.VISIBLE);
        } else {
            llLocationStatus.setVisibility(View.GONE);
            if (mLocationBroadcastReceiver.getStatus() == true) {
                unregisterReceiver(mLocationBroadcastReceiver);
                mLocationBroadcastReceiver.setStatus(false);
            }
        }
    }

    /**
     * 关于运行时授权地理位置的
     *
     * @param requestCode
     * @param permissions
     * @param grantResults
     */
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == requestCodeBluetooth) {
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                llLocationStatus.setVisibility(View.GONE);
            } else {
                Toast.makeText(this, "拒绝将导致软件无法运行", Toast.LENGTH_LONG).show();
            }
        } else if (requestCode == requestCodeCamera) {
            onViewClicked(findViewById(R.id.btn_scanQR));
        }
    }
//  endregion

    /**
     * 二维码扫描在该方法中拿到扫描的数据
     *
     * @param requestCode
     * @param resultCode
     * @param data
     */
    @Override
    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        if (resultCode == RESULT_OK) {
            if (requestCode == requestCodeQR) {
                String result = data.getStringExtra(KEY_RESULT);
                if (!result.contains("C0")) return;
                meterAddress = CheckUtils.Mac2MeterAddress(result);
                CheckUtils.setAddrss(meterAddress);
                tvBleName.setText("" + result);
                ((TextView) findViewById(R.id.tx_address)).setText("" + result);
            }
        }
    }
}